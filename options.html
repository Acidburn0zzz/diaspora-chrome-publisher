<!DOCTYPE>
<!--
 * Diaspora* Publisher extension.
 * Based on Email this page (by Google) extension
 * http://code.google.com/chrome/extensions/samples.html#028eb5364924344029bcbe1d527f132fc72b34e5
 * Author: Vittorio Cuculo <vittorio.cuculo@gmail.com>
 * Diaspora: lasek@diaspora.eigenlab.org
 *
 * Copyright (c) 2009 The Chromium Authors. All rights reserved.  Use of this
 * source code is governed by a BSD-style license that can be found in the
 * LICENSE file.
-->
<html>
<head>
  <title>Options for the Diaspora* Publisher extension</title>
<style>
#podSelection {
  font-family: Helvetica, Arial, sans-serif;
  font-size: 10pt;
}
</style>
<script type="text/javascript" src="jquery-1.6.2.min.js"></script>
<script>
function show(id, yes){
  if (yes)
	document.getElementById(id).style.display="block";
  else
     	document.getElementById(id).style.display="none";
}

function submit() {
  if (window.localStorage == null) {
    alert('Local storage is required for changing pod url');
    return;
  }
  if (document.getElementById('pod').value != ""){
	window.localStorage.podUrl = document.getElementById('pod').value;
 	document.getElementById('pod').placeholder = document.getElementById('pod').value;
  }
  show('ok', 1);
}

function combo(thelist, theinput) {
  theinput = document.getElementById(theinput);  
  var idx = thelist.selectedIndex;
  var content = thelist.options[idx].innerHTML;
  theinput.value = content;	
}

function main() {
  if (window.localStorage == null) {
    alert("LocalStorage must be enabled for changing options.");
    return;
  }

  $.get("podlist.txt", function(data) {
        var filePod = data.split("\n");;
        $.each(filePod, function() {
           $("#podlist").append('<option value="'+ this +'">'+ this +'</option>');
	});
  });


  if (window.localStorage.podUrl != null)
    document.getElementById('pod').placeholder = window.localStorage.podUrl;
  else
    document.getElementById('pod').placeholder = "diaspora.eigenlab.org";
}
</script>
</head>
<body onload="main()">
<table border="0">
<tr>
  <td rowspan="2" valign="top" align="center" width="80">
    <img src="info-48.png"/>
  </td>
  <td height="48"></td>
</tr>
<tr>
  <td valign="center">
    <form id="podSelection" action="javascript:submit();">
    <strong>Choose your Diaspora* Pod url, or insert a new one:</strong>
    <br /><br />

    <input id="pod" name="podurl" size="30" onFocus="show('ok', 0);">

    <select id="podlist" onChange="combo(this, 'pod')">
        <option>Please choose from above</option>
    </select>
    <input type="submit">
    <img id="ok" src="ok.png" style="display:none;">
    </form>
  </td>
</tr>
</table>
</body>
</html>
